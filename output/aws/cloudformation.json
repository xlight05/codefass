{
  "AWSTemplateFormatVersion" : "2010-09-09",
  "Description" : "An example template with an IAM role for a Lambda state machine.",
  "Resources" : {
    "LambdaExecutionRole" : {
      "Type" : "AWS::IAM::Role",
      "Properties" : {
        "AssumeRolePolicyDocument" : {
          "Version" : "2012-10-17",
          "Statement" : [ {
            "Effect" : "Allow",
            "Principal" : {
              "Service" : "lambda.amazonaws.com"
            },
            "Action" : "sts:AssumeRole"
          } ]
        }
      }
    },
    "function oneeee" : {
      "Type" : "AWS::Lambda::Function",
      "Properties" : {
        "Handler" : "ewww",
        "Role" : {
          "Fn::GetAtt" : [ "LambdaExecutionRole", "Arn" ]
        },
        "Code" : {
          "ZipFile" : "exports.handler = (event, context, callback) => {\n    callback(null, \"Hello From function oneeee!\");\n};\n"
        },
        "Runtime" : "nodejs12.x",
        "Timeout" : "25"
      }
    },
    "function twoo" : {
      "Type" : "AWS::Lambda::Function",
      "Properties" : {
        "Handler" : "ewww",
        "Role" : {
          "Fn::GetAtt" : [ "LambdaExecutionRole", "Arn" ]
        },
        "Code" : {
          "ZipFile" : "exports.handler = (event, context, callback) => {\n    callback(null, \"Hello From function twoo!\");\n};\n"
        },
        "Runtime" : "nodejs12.x",
        "Timeout" : "25"
      }
    },
    "function threee" : {
      "Type" : "AWS::Lambda::Function",
      "Properties" : {
        "Handler" : "ewwwww",
        "Role" : {
          "Fn::GetAtt" : [ "LambdaExecutionRole", "Arn" ]
        },
        "Code" : {
          "ZipFile" : "exports.handler = (event, context, callback) => {\n    callback(null, \"Hello From function threee!\");\n};\n"
        },
        "Runtime" : "nodejs12.x",
        "Timeout" : "25"
      }
    },
    "StatesExecutionRole" : {
      "Type" : "AWS::IAM::Role",
      "Properties" : {
        "AssumeRolePolicyDocument" : {
          "Version" : "2012-10-17",
          "Statement" : [ {
            "Effect" : "Allow",
            "Principal" : {
              "Service" : [ {
                "Fn::Sub" : "states.${AWS::Region}.amazonaws.com"
              } ]
            },
            "Action" : "sts:AssumeRole"
          } ]
        },
        "Path" : "/",
        "Policies" : [ {
          "PolicyName" : "StatesExecutionPolicy",
          "PolicyDocument" : {
            "Version" : "2012-10-17",
            "Statement" : [ {
              "Effect" : "Allow",
              "Action" : [ "lambda:InvokeFunction" ],
              "Resource" : "*"
            } ]
          }
        } ]
      }
    },
    "MyStateMachine" : {
      "Type" : "AWS::StepFunctions::StateMachine",
      "Properties" : {
        "DefinitionString" : {
          "Fn::Sub" : [ "{\"Comment\":\"Test Desc\",\"StartAt\":\"ChoiceBlock\",\"States\":{\"function oneeee\":{\"Type\":\"Task\",\"Resource\":\"lambdaArn\",\"Next\":\"function threee\"},\"function twoo\":{\"Type\":\"Task\",\"Resource\":\"lambdaArn\",\"Next\":\"function threee\"},\"function threee\":{\"Type\":\"Task\",\"Resource\":\"lambdaArn\",\"End\":true},\"ChoiceBlock\":{\"Type\":\"Choice\",\"Choices\":[{\"Not\":{\"Variable\":\"$.type\",\"StringEquals\":\"ew\"},\"Next\":\"function oneeee\"},{\"Not\":{\"Variable\":\"$.type\",\"NumericEquals\":25.0},\"Next\":\"function oneeee\"}],\"Default\":\"function twoo\"}}}", {
            "lambdaArn1" : {
              "Fn::GetAtt" : [ "FunctionOne", "Arn" ]
            },
            "lambdaArn2" : {
              "Fn::GetAtt" : [ "FunctionTwo", "Arn" ]
            }
          } ]
        },
        "RoleArn" : {
          "Fn::GetAtt" : [ "StatesExecutionRole", "Arn" ]
        }
      }
    }
  }
}
